<style>
  .marquee-section {
    width: 100%;
    overflow: hidden;
  }

  .marquee {
    height: 80px;
    display: flex;
    align-items: center;
    white-space: nowrap;
    overflow: hidden;
  }

  .marquee-content {
    display: inline-flex;
    align-items: center;
    gap: 3rem;
    white-space: nowrap;
  }

  .marquee-content span {
    font-family: var(--font-second, inherit);
    font-size: 1.5rem;
    letter-spacing: 0.3em;
    color: {{ section.settings.text_color }};
    white-space: nowrap;
  }

  #marquee-{{ section.id }} * {
     color: {{ section.settings.text_color }};
  }

  /* Fallback animation nếu jQuery không hoạt động */
  @keyframes marqueeAnimation {
    0% {
      transform: translateX(100%);
    }
    100% {
      transform: translateX(-100%);
    }
  }

  .marquee-fallback {
    animation: marqueeAnimation 30s linear infinite;
  }

  .marquee-content * {
    font-family: var(--font-second);
  }

  .marquee > div {
    display: flex !important;
    align-items: center !important;
  }
</style>

<div class="marquee-section" style="background-color: {{ section.settings.background_color }};">
  <div class="marquee" id="marquee-{{ section.id }}">
    <div class="marquee-content">
      {% for block in section.blocks %}
        <span>{{ block.settings.text }}</span>
        {% unless forloop.last %}
        {% endunless %}
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    if (typeof jQuery !== 'undefined' && jQuery.fn.marquee) {
      try {
        $('#marquee-{{ section.id }}').marquee({
          duration: {{ section.settings.speed | times: 1000 }},
          delayBeforeStart: 0,
          direction: '{{ section.settings.direction }}',
          duplicated: true,
          pauseOnHover: true,
          startVisible: true,
        });
      } catch (error) {
        document.querySelector('#marquee-{{ section.id }} .marquee-content').classList.add('marquee-fallback');
      }
    } else {
      document.querySelector('#marquee-{{ section.id }} .marquee-content').classList.add('marquee-fallback');
    }
  });
</script>

{% schema %}
{
  "name": "Marquee text",
  "settings": [
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#f9423a"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Animation Speed (seconds)",
      "min": 10,
      "max": 60,
      "step": 5,
      "default": 30
    },
    {
      "type": "select",
      "id": "direction",
      "label": "Direction",
      "options": [
        {
          "value": "left",
          "label": "Right to Left"
        },
        {
          "value": "right",
          "label": "Left to Right"
        }
      ],
      "default": "left"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Marquee Item",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Content",
          "default": "<p>✨ <strong>I LET MY INNER LIGHT SHINE</strong> ✨</p>"
        }
      ]
    }
  ],
  "max_blocks": 20,
  "presets": [
    {
      "name": "Marquee text",
      "blocks": [
        {
          "type": "item",
          "settings": {
            "text": "<p>✨ <strong>I LET MY INNER LIGHT SHINE</strong> ✨</p>"
          }
        }
      ]
    }
  ]
}
{% endschema %}
