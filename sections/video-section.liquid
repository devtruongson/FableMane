<div class="video-product-carousel py-8">
  <div class="carousel-wrapper">
    {% for block in section.blocks %}
      <div class="video-item px-4 h-[420px] transition-all duration-300" {{ block.shopify_attributes }}>
        <!-- Video -->
        <div class="video-wrapper mb-4  h-[420px] rounded-xl  transition-all duration-300">
          {% if block.settings.video_url contains 'youtube' or block.settings.video_url contains 'vimeo' %}
            <iframe
              class="w-full h-[100%] object-cover rounded-xl"
              src="{{ block.settings.video_url }}"
              frameborder="0"
              allowfullscreen
            ></iframe>
          {% else %}
            <video
              class="w-full h-[100%] object-cover rounded-xl"
              muted
              playsinline
              data-video-src="{{ block.settings.video_url }}"
            >
              <source src="{{ block.settings.video_url }}" type="video/mp4">
            </video>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const $carousel = $('.video-product-carousel .carousel-wrapper');

    // Initialize Slick carousel
    $carousel.slick({
      slidesToShow: 8,
      slidesToScroll: 1,
      arrows: true,
      infinite: false,
      centerMode: true,
      centerPadding: '60px',
      focusOnSelect: true,
      prevArrow: `<button type="button" class="bg-[#fff] w-[40px] h-[40px] rounded-[50%] flex justify-center items-center slick-prev cursor-pointer absolute left-[10px] hover:shadow-md  top-1/2 transform -translate-y-1/2 z-10">
               <svg width="30" height="30" viewBox="0 0 24 24">
                 <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" fill="none"/>
               </svg>
            </button>`,
      nextArrow: `<button type="button" class="bg-[#fff] w-[40px] h-[40px] rounded-[50%] flex justify-center items-center slick-next cursor-pointer absolute right-[10px]  hover:shadow-md top-1/2 transform -translate-y-1/2 z-10">
               <svg width="30" height="30" viewBox="0 0 24 24">
                 <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" fill="none"/>
               </svg>
            </button>`,
    });

    // Function to handle video play/pause and styling
    function handleVideoChange(slideIndex) {
      const $allVideos = $carousel.find('video');
      const $allItems = $carousel.find('.video-item');

      // Pause all videos and reset styling
      $allVideos.each(function () {
        this.pause();
        this.currentTime = 0;
      });

      // Remove active styling from all items
      $allItems.removeClass('active-video');

      // Get current active slide
      const $activeSlide = $carousel.find('.slick-slide').eq(slideIndex);
      const $activeVideo = $activeSlide.find('video');
      const $activeItem = $activeSlide.find('.video-item');

      if ($activeVideo.length > 0) {
        // Add active styling and play video
        $activeItem.addClass('active-video');
        $activeVideo[0].play().catch((e) => console.log('Video play failed:', e));
      }
    }

    // Handle slide change
    $carousel.on('beforeChange', function (event, slick, currentSlide, nextSlide) {
      handleVideoChange(nextSlide);
    });

    // Handle click on video items
    $carousel.on('click', '.video-item', function () {
      const slideIndex = $(this).closest('.slick-slide').data('slick-index');
      $carousel.slick('slickGoTo', slideIndex);
    });

    // Initialize first video (center slide)
    setTimeout(() => {
      const centerSlideIndex = Math.floor($carousel.slick('getSlick').slideCount / 2);
      handleVideoChange(centerSlideIndex);
      $carousel.slick('slickGoTo', centerSlideIndex);
    }, 100);
  });
</script>

<style>
  .product-list[data-collapsed='true'] .product-card:not(.first-product) {
    display: none;
  }

  /* Video carousel styling */
  .video-product-carousel .carousel-wrapper {
    overflow: visible !important;
  }

  .video-product-carousel .slick-list {
    overflow: visible !important;
  }

  .video-product-carousel .slick-track {
    display: flex !important;
    align-items: center;
  }

  .video-product-carousel .slick-slide {
    transition: all 0.3s ease;
    opacity: 0.7;
    padding: 0 10px;
  }

  .video-product-carousel .slick-center {
    opacity: 1;
  }

  .video-product-carousel .slick-center .video-wrapper {
    transform: scale(1.2);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    margin: 0 20px;
    z-index: 10;
    position: relative;
  }

  .video-item {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .video-wrapper {
    transition: all 0.3s ease;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .video-product-carousel .carousel-wrapper {
      .slick-list {
        overflow: visible;
      }
    }

    .video-product-carousel .slick-center .video-wrapper {
      /* transform: scale(1.2); */
      margin: 0 10px;
    }
  }

  /* Ensure videos don't autoplay by default */
  .video-product-carousel video {
    pointer-events: none;
  }

  .video-product-carousel .slick-center video {
    pointer-events: auto;
  }
</style>

{% schema %}
{
  "name": "Video Product Carousel",
  "settings": [],
  "blocks": [
    {
      "type": "item",
      "name": "Video & Product Carousel",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL (YouTube, Vimeo, or MP4)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video Product Carousel"
    }
  ]
}
{% endschema %}
